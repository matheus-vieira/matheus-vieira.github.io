--- layout: interview_question title: how" usar Bicep to provisionar um ambiente in the Azure and suas vantagens" tags: [azure, bicep, iac, infrastructure-as-code, devops, arm, provisioning, cloud] order: 151 --- ## Introdução Bicep is uma linguagem of domínio específico (DSL) desenvolvida pela Microsoft how uma abstração sobre templates ARM (Azure Resource Manager). Ela offers uma sintaxe mais limpa and legível to definir infraestrutura how código in the Azure, simplificando significativamente o processo of provisionamento of resources. ## Conceito-chave O Bicep funciona how uma linguagem transpilada que converte código Bicep in templates ARM JSON. Isso allows aproveitar toda a funcionalidade of the ARM enquanto offers uma experiência of development muito superior, with sintaxe declarativa mais intuitiva and ferramentas avançadas of development. ## Tópicos Relevantes ### Estrutura básica of um arquivo Bicep ```bicep // Parâmetros of entrada param location string = resourceGroup().location param appServicePlanName string param webAppName string // Variáveis computadas var appServicePlanSku = 'F1' // Resources resource appServicePlan 'Microsoft.Web/serverfarms@2021-02-01' = { name: appServicePlanName location: location sku: { name: appServicePlanSku tier: 'Free' } } resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: webAppName location: location properties: { serverFarmId: appServicePlan.id } } ``` ### Módulos and reutilização ```bicep // Módulo to storage account module storageAccount 'modules/storage.bicep' = { name: 'storageDeployment' params: { storageAccountName: 'mystorageaccount' location: location } } ``` ### Loops and condicionais ```bicep // Loop to criar múltiplos resources resource storageAccounts 'Microsoft.Storage/storageAccounts@2021-04-01' = [for i in range(0, 3): { name: 'storage${i}' location: location kind: 'StorageV2' sku: { name: 'Standard_LRS' } }] // Condicional resource publicIP 'Microsoft.Network/publicIPAddresses@2021-02-01' = if (createPublicIP) { name: publicIPName location: location } ``` ## Exemplo Prático Provisionamento of um ambiente completo with Web App, SQL Database and Application Insights: ```bicep // main.bicep targetScope = 'resourceGroup' @description('Nome of the ambiente (dev, staging, prod)') param environmentName string = 'dev' @description('Nome of the application') param applicationName string param location string = resourceGroup().location // Variáveis var resourcePrefix = '${applicationName}-${environmentName}' var tags = { Environment: environmentName Application: applicationName ManagedBy: 'Bicep' } // App Service Plan resource appServicePlan 'Microsoft.Web/serverfarms@2021-02-01' = { name: '${resourcePrefix}-asp' location: location tags: tags sku: { name: environmentName == 'prod' ? 'P1v2' : 'F1' tier: environmentName == 'prod' ? 'PremiumV2' : 'Free' } } // Web App resource webApp 'Microsoft.Web/sites@2021-02-01' = { name: '${resourcePrefix}-webapp' location: location tags: tags properties: { serverFarmId: appServicePlan.id httpsOnly: true siteConfig: { minTlsVersion: '1.2' ftpsState: 'Disabled' connectionStrings: [ { name: 'DefaultConnection' connectionString: 'Server=${sqlServer.properties.fullyQualifiedDomainName};Database=${sqlDatabase.name};Trusted_Connection=False;Encrypt=True;' type: 'SQLAzure' } ] } } identity: { type: 'SystemAssigned' } } // SQL Server resource sqlServer 'Microsoft.Sql/servers@2021-02-01' = { name: '${resourcePrefix}-sql' location: location tags: tags properties: { administratorLogin: 'sqladmin' administratorLoginPassword: 'P@ssw0rd123!' } } // SQL Database resource sqlDatabase 'Microsoft.Sql/servers/databases@2021-02-01' = { parent: sqlServer name: '${applicationName}DB' location: location tags: tags sku: { name: environmentName == 'prod' ? 'S2' : 'Basic' tier: environmentName == 'prod' ? 'Standard' : 'Basic' } } // Application Insights resource appInsights 'Microsoft.Insights/components@2020-02-02' = { name: '${resourcePrefix}-ai' location: location tags: tags kind: 'web' properties: { Application_Type: 'web' } } // Key Vault to secrets resource keyVault 'Microsoft.KeyVault/vaults@2021-04-01-preview' = { name: '${resourcePrefix}-kv' location: location tags: tags properties: { sku: { family: 'A' name: 'standard' } tenantId: tenant().tenantId accessPolicies: [ { tenantId: tenant().tenantId objectId: webApp.identity.principalId permissions: { secrets: ['get', 'list'] } } ] } } // Outputs output webAppUrl string = 'https://${webApp.properties.defaultHostName}' output sqlServerName string = sqlServer.name output keyVaultName string = keyVault.name ``` ### Deployment with Azure CLI ```bash # Criar resource group az group create --name myapp-dev-rg --location eastus # Deploy of the Bicep az deployment group create \ --resource-group myapp-dev-rg \ --template-file main.bicep \ --parameters environmentName=dev applicationName=myapp ``` ## Benefícios ### 1. **Sintaxe mais limpa and legível** - Redução significativa of código comparado ao ARM JSON - Sintaxe mais próxima of linguagens of programação modernas - Melhor legibilidade and manutenibilidade ### 2. **Tooling superior** - IntelliSense avançado in the VS Code - Validação in tempo real - Debugging and error reporting melhorados - Extension oficial of the Microsoft ### 3. **Modularidade and reutilização** - Sistema of módulos nativo - Facilita a criação of bibliotecas of componentes - Promove boas práticas of arquitetura ### 4. security** aprimorada** - Validação of tipos in tempo of compilação - Prevenção of configurações inseguras - Integration with Azure Policy ### 5. **Compatibilidade total with ARM** - Compila to ARM templates padrão - Aproveita toda funcionalidade existente - Facilita migração of templates ARM existentes ### 6. **Versionamento and governance** - Integration natural with controle of versão - Facilita code reviews - Suporte a GitOps workflows ### 7. **Performance of deployment** - Deployments incrementais inteligentes - Detecção automática of mudanças - Optimization of dependências entre resources